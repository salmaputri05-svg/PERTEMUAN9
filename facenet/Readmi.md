# Analisis Kode Program
## build_embeddings.py
Kode tersebut digunakan untuk membaca seluruh gambar dalam folder dataset, mengekstraksi embedding wajah menggunakan fungsi embed_from_path, lalu menyimpannya dalam bentuk matriks NumPy untuk keperluan pelatihan model face recognition. Fungsi iter_images() bertugas menelusuri folder root dan menghasilkan pasangan path gambar serta nama kelas (subfolder). Setiap subfolder dianggap sebagai satu identitas. Fungsi build_matrix() kemudian memproses setiap gambar menggunakan ekstraksi embedding; jika embedding gagal dibuat maka path gambar dimasukkan ke dalam daftar bad. Embedding yang berhasil dikumpulkan ke dalam array X sebagai fitur, sedangkan label identitasnya disimpan dalam y. Setelah selesai, data disimpan ke file X_train.npy dan y_train.npy agar tidak perlu menghitung ulang embedding di kemudian hari. Program utama menjalankan proses ini pada folder data/train dan mencetak jumlah gambar yang gagal diproses. Dengan kata lain, kode ini berfungsi untuk membangun dataset embedding wajah secara otomatis dan terstruktur sebelum pelatihan model.
## eval_folder.py
Kode tersebut digunakan untuk membaca seluruh gambar dalam folder dataset, mengekstraksi embedding wajah menggunakan fungsi embed_from_path, lalu menyimpannya dalam bentuk matriks NumPy untuk keperluan pelatihan model face recognition. Fungsi iter_images() bertugas menelusuri folder root dan menghasilkan pasangan path gambar serta nama kelas (subfolder). Setiap subfolder dianggap sebagai satu identitas. Fungsi build_matrix() kemudian memproses setiap gambar menggunakan ekstraksi embedding; jika embedding gagal dibuat maka path gambar dimasukkan ke dalam daftar bad. Embedding yang berhasil dikumpulkan ke dalam array X sebagai fitur, sedangkan label identitasnya disimpan dalam y. Setelah selesai, data disimpan ke file X_train.npy dan y_train.npy agar tidak perlu menghitung ulang embedding di kemudian hari. Program utama menjalankan proses ini pada folder data/train dan mencetak jumlah gambar yang gagal diproses. Dengan kata lain, kode ini berfungsi untuk membangun dataset embedding wajah secara otomatis dan terstruktur sebelum pelatihan model.
## predict_one.py
Kode ini digunakan untuk melakukan prediksi identitas wajah berdasarkan gambar menggunakan model SVM yang sebelumnya telah dilatih dengan embedding FaceNet. Pertama, model klasifikasi facenet_svm.joblib dimuat menggunakan joblib.load. Fungsi predict_image() kemudian menerima path gambar dan melakukan ekstraksi embedding melalui embed_from_path. Jika wajah tidak terdeteksi, fungsi langsung mengembalikan label "NO_FACE". Jika embedding berhasil, program menghitung probabilitas setiap kelas menggunakan predict_proba, lalu menentukan kelas dengan probabilitas tertinggi melalui argmax. Label prediksi dan tingkat kepercayaan (confidence) diambil dari model. Jika confidence tersebut berada di bawah ambang batas (threshold) 0.55, wajah dianggap tidak cocok dengan identitas mana pun dan akan dikembalikan sebagai "UNKNOWN". Jika confidence memenuhi syarat, nama label sebenarnya dikembalikan bersamaan dengan nilai confidence. Pada bagian main, fungsi ini diuji menggunakan sebuah gambar contoh dari folder dataset untuk melihat hasil identifikasi wajah. Dengan demikian, kode ini berfungsi sebagai modul inferensi FaceNet+SVM yang sederhana dan langsung dapat digunakan untuk melakukan face recognition pada single image.
## train_classifier.py
Kode ini digunakan untuk melatih model klasifikasi wajah berbasis SVM menggunakan embedding FaceNet yang sudah disimpan pada file X_train.npy dan y_train.npy. Pertama, data fitur (embedding) dan label identitas dimuat menggunakan NumPy. Model kemudian dibangun menggunakan Pipeline yang terdiri dari dua tahap: normalisasi data dengan StandardScaler agar distribusi fitur lebih stabil, dan model SVC dengan kernel RBF serta probability=True agar dapat menghasilkan probabilitas prediksi. Parameter class_weight="balanced" digunakan untuk mengatasi ketidakseimbangan jumlah data antar kelas. Sebelum training, dilakukan evaluasi awal menggunakan cross-validation 2-fold untuk mengukur akurasi rata-rata model pada data pelatihan. Setelah itu, model dilatih sepenuhnya menggunakan seluruh data, lalu disimpan ke file facenet_svm.joblib menggunakan joblib.dump agar dapat dipakai pada proses prediksi di program lain. Secara keseluruhan, kode ini berfungsi sebagai tahap training dan penyimpanan model SVM untuk sistem face recognition berbasis embedding FaceNet.
## train_knn.py
Kode ini digunakan untuk melatih model klasifikasi wajah berbasis algoritma K-Nearest Neighbors (KNN) menggunakan embedding wajah FaceNet yang tersimpan pada file X_train.npy dan y_train.npy. Data embedding (X) dan label identitas (y) dimuat terlebih dahulu. Model kemudian dibentuk menggunakan Pipeline yang terdiri dari dua komponen utama: StandardScaler untuk menormalkan nilai fitur—karena KNN sensitif terhadap skala jarak—dan KNeighborsClassifier dengan 3 tetangga terdekat (n_neighbors=3) serta metrik jarak Euclidean yang umum digunakan pada data embedding. Setelah pipeline dibentuk, model dilatih menggunakan seluruh data yang tersedia dengan memanggil clf.fit(X, y). Model terlatih kemudian disimpan ke file facenet_knn.joblib menggunakan joblib.dump agar dapat digunakan kembali untuk proses prediksi wajah tanpa harus melatih ulang. Secara ringkas, kode ini adalah modul training sederhana yang membangun model face recognition berbasis KNN dari embedding FaceNet.
## utils_facenet.py
Kode ini merupakan modul lengkap untuk melakukan deteksi wajah, alignment, dan ekstraksi embedding menggunakan FaceNet berbasis facenet-pytorch. Pertama, MTCNN digunakan sebagai face detector sekaligus face aligner, menghasilkan gambar wajah terpotong dan terstandarkan berukuran 160×160 piksel. Kemudian, model InceptionResnetV1 yang telah dipra-latih pada dataset VGGFace2 dipakai sebagai embedder untuk menghasilkan vektor fitur berdimensi 512 yang mewakili karakteristik wajah. Program menyediakan beberapa fungsi utilitas seperti membaca gambar dalam format BGR menggunakan OpenCV, mengonversinya ke PIL image, serta menjalankan proses alignment dan ekstraksi embedding tanpa gradient (@torch.no_grad()), sehingga efisien untuk inference. Jika wajah tidak terdeteksi, fungsi otomatis mengembalikan None. Selain itu, disertakan fungsi cosine_similarity untuk menghitung kesamaan dua embedding wajah berdasarkan metode cosine similarity yang umum digunakan pada FaceNet. Secara keseluruhan, kode ini menjadi fondasi utama untuk semua proses face recognition karena menyediakan pipeline deteksi, preprocessing, dan embedding yang rapi dan siap digunakan.
## verify_cli.py
Kode ini adalah skrip sederhana untuk membandingkan dua gambar wajah dan menentukan apakah keduanya merupakan orang yang sama berdasarkan nilai kemiripan (similarity). Pertama, program menggunakan argparse untuk menerima dua argumen path gambar (img1 dan img2), serta ambang batas kesamaan (--th) dengan nilai default 0.85. Kedua gambar diproses oleh fungsi embed_from_path, yang akan mendeteksi wajah, melakukan alignment, dan menghasilkan embedding FaceNet. Jika salah satu wajah tidak terdeteksi, program langsung menampilkan pesan "Wajah tidak terdeteksi." Jika keduanya valid, nilai kesamaan dihitung menggunakan fungsi cosine_similarity yang mengembalikan skor antara −1 hingga 1. Hasil similarity kemudian dicetak dan dibandingkan dengan threshold untuk menentukan apakah kedua wajah dianggap MATCH (sama) atau NO MATCH (berbeda). Dengan demikian, skrip ini berfungsi sebagai alat verifikasi wajah berbasis FaceNet yang dapat dijalankan langsung dari terminal.
## verify_pair.py 
Kode ini digunakan untuk melakukan verifikasi wajah dengan membandingkan dua gambar menggunakan embedding FaceNet. Dua path gambar (img1 dan img2) diproses melalui fungsi embed_from_path yang bertugas mendeteksi, meng-align, dan mengekstraksi embedding masing-masing wajah. Jika salah satu gambar tidak mengandung wajah, program langsung menampilkan pesan “Wajah tidak terdeteksi.” Jika kedua embedding berhasil diperoleh, nilai kesamaan dihitung menggunakan cosine_similarity. Nilai similarity ini kemudian dibandingkan dengan threshold 0.85; jika lebih besar atau sama dengan threshold, kedua wajah dianggap berasal dari orang yang sama (MATCH), jika tidak maka dianggap berbeda (NO MATCH). Secara keseluruhan, kode ini merupakan implementasi sederhana untuk melakukan face verification menggunakan metrik cosine similarity dari embedding FaceNet.
